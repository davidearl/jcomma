<!DOCTYPE html><html><head><meta charset="utf-8"><title> jcomma: help.md</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1><a id="logohttpsjcommadavidearluklogosvg_jcomma_help_0"></a><img src="https://jcomma.davidearl.uk/logo.svg" alt="logo"> jcomma: help</h1>
<p class="has-line-data" data-line-start="2" data-line-end="3">jcomma converts CSV (and TSV) files to other formats and sanitizes them so that they are not subject to the vagaries of the generator of the CSV.</p>
<p class="has-line-data" data-line-start="4" data-line-end="5"><strong>Live version at <a href="https://jcomma.davidearl.uk">https://jcomma.davidearl.uk</a></strong></p>
<p class="has-line-data" data-line-start="6" data-line-end="7">CSV is a truly terrible format for data interchange, especially internationally. Yet, it is still ubiquitous in all sorts of scenarios, and it is popular because it is fairly easy for non-programmers to understand (partly because it glosses over the problems!) so we often have to deal with such files when we’d rather not.</p>
<p class="has-line-data" data-line-start="8" data-line-end="9">For example, banks frequently generate CSVs with:</p>
<ul>
<li class="has-line-data" data-line-start="9" data-line-end="10">interleaved headers every few entries,</li>
<li class="has-line-data" data-line-start="10" data-line-end="11">more than one header line,</li>
<li class="has-line-data" data-line-start="11" data-line-end="12">currency symbols where you just want a number,</li>
<li class="has-line-data" data-line-start="12" data-line-end="13">dates in unsuitable or ambiguous formats,</li>
<li class="has-line-data" data-line-start="13" data-line-end="14">parentheses or trailing minus signs as negatives where ordinary mortals would put a normal negative,</li>
<li class="has-line-data" data-line-start="14" data-line-end="16">positive values (e.g. deposits) in one column and negatives in another (e.g. withdrawals) where you just want a single number which is positive or negative.</li>
</ul>
<p class="has-line-data" data-line-start="16" data-line-end="17">Furthermore, CSV files don’t have any means to indicate what character set encoding they use, and very often Excel - or the person who used Excel to send it to you - produces one (typically Windows) and your consumer needs another (often UTF-8). Particularly a problem with things like £ signs.</p>
<p class="has-line-data" data-line-start="18" data-line-end="19">jcomma addresses these problems, especially when you encounter files laid out the same way repeatedly.</p>
<h2 class="code-line" data-line-start=20 data-line-end=21><a id="Usage_20"></a>Usage</h2>
<p class="has-line-data" data-line-start="22" data-line-end="23">See also <a href="#hinstallation">installation</a>.</p>
<p class="has-line-data" data-line-start="24" data-line-end="25">(#husewebapp)</p>
<h3 class="code-line" data-line-start=25 data-line-end=26><a id="As_a_web_app_25"></a>As a web app</h3>
<p class="has-line-data" data-line-start="27" data-line-end="28">Fill in the form and click <strong>Do It!</strong>. Each reload of the page remembers the recipe for interpreting the CSV file, and you can also save and restore a recipe from file or browser storage.</p>
<p class="has-line-data" data-line-start="29" data-line-end="30">If you give a URL to a recipe on the web, jcomma will load that rather than the most recently used. For example:</p>
<pre><code>https://jcomma.davidearl.uk/?recipe=https%3A%2F%2Fexample.com%2Fsome_recipe.json  
</code></pre>
<p class="has-line-data" data-line-start="33" data-line-end="34">which means you can share a recipe efficiently. (If you put it in Google Drive or Dropbox, we’ll convert the link they give you when you share the file to one which is directly download-able). Don’t forget that the second URL must be percent-encoded when used as a parameter in the main URL (you can do that most easily by loading it in the box provided and then copying the URL)</p>
<p class="has-line-data" data-line-start="35" data-line-end="36">(#huseapi)</p>
<h3 class="code-line" data-line-start=36 data-line-end=37><a id="Via_API_36"></a>Via API</h3>
<p class="has-line-data" data-line-start="38" data-line-end="39">Either:</p>
<ul>
<li class="has-line-data" data-line-start="40" data-line-end="41">do a multipart-encoded POST to /jcomma.php, providing the CSV file as ‘csv’ and the recipe as ‘recipe’, a JSON string encoding all the options, <a href="#hrecipe">as shown below</a>, in a single POST parameter; or</li>
<li class="has-line-data" data-line-start="41" data-line-end="43">do a POST (which doesn’t have to be multipart-encoded) with ‘recipe’ as above and ‘csvpaste’ as the CSV data as a POST parameter (suitably encoded, of course).</li>
</ul>
<p class="has-line-data" data-line-start="43" data-line-end="44">For example:</p>
<pre><code>curl -F &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="116374727861742c516374727861743f7b627e7f">[email&#160;protected]</a>&quot; -F &quot;<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="127161642f527f6b3c716164">[email&#160;protected]</a>&quot; &quot;https://jcomma.davidearl.uk/jcomma.php&quot;
</code></pre>
<p class="has-line-data" data-line-start="47" data-line-end="48">You can use the web app to make a recipe file, save it, and then use that programatically; or make one on the fly.</p>
<p class="has-line-data" data-line-start="49" data-line-end="50">(#huselibrary)</p>
<h3 class="code-line" data-line-start=50 data-line-end=51><a id="As_a_library_50"></a>As a library</h3>
<p class="has-line-data" data-line-start="52" data-line-end="53">To use as a library when installed with composer, include <code>vendor/autoload.php</code>, or otherwise include <code>lib/JComma.php</code> in your PHP application, and use like this:</p>
<pre><code>$j = new \DavidEarl\JComma\JComma($pathtocsv, $recipeobject /* not JSON: already decoded */);
$errors = $j-&gt;validate(); // produces array of error message strings, or empty array if recipe is OK
if (empty($errors)) {
    $result = $j-&gt;convert(); // produces array of objects
    $j-&gt;output($result, $filename, $cl); /* optional: if you want to actually emit a file or string */
}
</code></pre>
<p class="has-line-data" data-line-start="61" data-line-end="62">$recipe-&gt;outputTo can be set to ‘string’ (unlike when used via the API), when it is converted to the output format but returned as a string rather than emitted to stdout. $cl=TRUE (“command line”) is optional, and omits all headers</p>
<p class="has-line-data" data-line-start="63" data-line-end="64">(#huseshell)</p>
<h3 class="code-line" data-line-start=64 data-line-end=65><a id="In_a_shell_command_line_64"></a>In a shell command line</h3>
<p class="has-line-data" data-line-start="66" data-line-end="67">Like this, for example:</p>
<pre><code>php jcomma.php -s recipe.json my.csv
</code></pre>
<p class="has-line-data" data-line-start="70" data-line-end="71">The result is written to standard output. recipe.json is the file containing a json representation of the options, <a href="#hrecipe">as shown below</a>. If the input csv path is ‘-’ or omitted, it is read from standard input, so the command can be used in a pipe:</p>
<pre><code>echo my.csv | php jcomma.php -s recipe.json &gt; my.xml
</code></pre>
<p class="has-line-data" data-line-start="74" data-line-end="75">(#hloadrecipe)</p>
<h2 class="code-line" data-line-start=75 data-line-end=76><a id="Load_recipe_75"></a>Load recipe</h2>
<p class="has-line-data" data-line-start="77" data-line-end="78">You can load the recipe previously saved with the link at the bottom of the page (or prepared elswhere) by opening the JSON file with the <strong>choose file</strong> button here. In Chrome you can just drop the file onto the button.</p>
<p class="has-line-data" data-line-start="79" data-line-end="80">You can also load the recipe from the cloud by providing a URL. If successful, the URL is included in the address of the page, so you can distribute that URL to share the recipe pre-loaded in jcomma. Note that shared Google Drive and Dropbox URLs would normally take you to a download page, but jcomma converts these so they can be loaded directly from the sharing URL provided by these apps.</p>
<p class="has-line-data" data-line-start="81" data-line-end="82">Alternatively, copy the JSON and paste it into the box provided.</p>
<p class="has-line-data" data-line-start="83" data-line-end="84">(#hresetrecipe)</p>
<h2 class="code-line" data-line-start=84 data-line-end=85><a id="Reset_recipe_84"></a>Reset recipe</h2>
<p class="has-line-data" data-line-start="86" data-line-end="87">Clicking this just resets the page to the simplest possible recipe for you to then exand on (it may be needed since the page remembers each change).</p>
<p class="has-line-data" data-line-start="88" data-line-end="89">(#hloadselect)</p>
<h2 class="code-line" data-line-start=89 data-line-end=90><a id="Choose_recipe_89"></a>Choose recipe</h2>
<p class="has-line-data" data-line-start="91" data-line-end="92">When you give your recipe a name, the browser automatically remembers it using that name, so you can reload it by selecting the name from this menu.</p>
<p class="has-line-data" data-line-start="93" data-line-end="94">(#hdeleterecipe)</p>
<h2 class="code-line" data-line-start=94 data-line-end=95><a id="Delete_recipe_94"></a>Delete recipe</h2>
<p class="has-line-data" data-line-start="96" data-line-end="97">As the browser saves all named recipes separately, there needs to be a way to clear them out. Just load the relevant recipe from the menu and then press the <a href="#hdeleterecipe">delete link</a>.</p>
<p class="has-line-data" data-line-start="98" data-line-end="99">(#hsaverecipe)</p>
<h2 class="code-line" data-line-start=99 data-line-end=100><a id="Save_recipe_99"></a>Save recipe</h2>
<p class="has-line-data" data-line-start="101" data-line-end="102">All the settings described in the form are saved as a jcomma recipe, a JSON file, to a local file. Note that tghe whole recipe is saved on every change so if the page is reloaded, changes are not lost.</p>
<p class="has-line-data" data-line-start="103" data-line-end="104">Alternatively copy the JSON from the box provided to where you need it, optionally laid out prettily by checking “pretty print layout”.</p>
<p class="has-line-data" data-line-start="105" data-line-end="106">As well as <a href="#hloadrecipe">restoring them</a> to the page, a saved recipe can be used in automated workflows using jcomma, so that the recipes do not need to be hand written in JSON.</p>
<h2 class="code-line" data-line-start=107 data-line-end=108><a id="Output_settings_107"></a>Output settings</h2>
<p class="has-line-data" data-line-start="109" data-line-end="110">(#hrecipename)</p>
<h3 class="code-line" data-line-start=110 data-line-end=111><a id="Recipe_name_110"></a>Recipe name</h3>
<p class="has-line-data" data-line-start="112" data-line-end="113">You can give your recipe a name, for your own reference. Named recipes are stored by the browser so can be retrieved by name.</p>
<p class="has-line-data" data-line-start="114" data-line-end="115">(#hcomment)</p>
<h3 class="code-line" data-line-start=115 data-line-end=116><a id="Comment_115"></a>Comment</h3>
<p class="has-line-data" data-line-start="117" data-line-end="118">This is just saved with the recipe so when you look in the file there is something to tell you what it is for. It’s not saved with the output, just with <a href="#hrecipe">the recipe</a>.</p>
<p class="has-line-data" data-line-start="119" data-line-end="120">(#houtputto)</p>
<h3 class="code-line" data-line-start=120 data-line-end=121><a id="Output_to_120"></a>Output to</h3>
<p class="has-line-data" data-line-start="122" data-line-end="123">Choose whether to save the output to a downloaded file or to display it in a browser tab. Note that csv and xlsx files are always downloaded (because browsers don’t know what to do with them).</p>
<p class="has-line-data" data-line-start="124" data-line-end="125">This corresponds to the <code>&quot;outputTo&quot;: &quot;...&quot;</code> <a href="#hrecipe">in the recipe</a>, with values ‘inline’ (for display) and ‘attachment’ (for download), and when used as the library ‘string’ to retrieve the result as a string.</p>
<p class="has-line-data" data-line-start="126" data-line-end="127">(#houtputformat)</p>
<h3 class="code-line" data-line-start=127 data-line-end=128><a id="Output_format_127"></a>Output format</h3>
<p class="has-line-data" data-line-start="129" data-line-end="130">jcomma can write its result in a variety of formats (<code>&quot;outputFormat&quot;: &quot;json&quot;</code> for example <a href="#hrecipe">in the recipe</a>). Some of these have additional options:</p>
<ul>
<li class="has-line-data" data-line-start="131" data-line-end="134">
<p class="has-line-data" data-line-start="131" data-line-end="132"><strong>json</strong>: creates a JSON array of objects, one for each line, or group of lines, in the input CSV. (Note: JSON is encoded as UTF-8 by definition).</p>
<ul>
<li class="has-line-data" data-line-start="132" data-line-end="133"><strong><em>pretty print</em></strong> (<code>&quot;outputStyle&quot;: &quot;pretty&quot;</code> <a href="#hrecipe">in the recipe</a>): lays out the JSON output in an easier-to-read layout rather than all in one line</li>
<li class="has-line-data" data-line-start="133" data-line-end="134"><strong><em>bulk data for elasticsearch</em></strong>: (<code>&quot;outputBulkElastic&quot;: true</code> <a href="#hrecipe">in the recipe</a>): instead of an array, creates one line for each record, interleaved with JSON objects to control elasticsearch for creation of elasticsearch documents using its <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html">bulk api</a>. The type of each record is filled in from the type name field if given (<code>&quot;outputName&quot;: &quot;name&quot;</code> <a href="#hrecipe">in the recipe</a>) or the name of the input file (less suffix) if not. (note: pretty print is ignored in this case)</li>
</ul>
</li>
<li class="has-line-data" data-line-start="134" data-line-end="137">
<p class="has-line-data" data-line-start="134" data-line-end="135"><strong>csv</strong>: a transformation of the input CSV. Each record generated forms a row and each field generated a column cell in that row.</p>
<ul>
<li class="has-line-data" data-line-start="135" data-line-end="136"><strong><em>output encoding</em></strong> (<code>&quot;outputEncoding&quot;: &quot;whatever&quot;</code> <a href="#hrecipe">in the recipe</a>): the character encoding of the output CSV.</li>
<li class="has-line-data" data-line-start="136" data-line-end="137"><strong><em>include header row</em></strong> (<code>&quot;outputHeaderRow&quot;: true</code> <a href="#hrecipe">in the recipe</a>): include a header row comprising the field names given below</li>
</ul>
</li>
<li class="has-line-data" data-line-start="137" data-line-end="139">
<p class="has-line-data" data-line-start="137" data-line-end="138"><strong>xlsx</strong>: Microsoft’s Excel 2007 spreadsheet format. This is better than CSV in that the character encoding is well defined, and the types of the data cells can be set explicitly. This uses <a href="https://github.com/mk-j/PHP_XLSXWriter">PHP_XLSXWriter</a> (<em>thank you mk-j; MIT license</em>) to make the file.</p>
<ul>
<li class="has-line-data" data-line-start="138" data-line-end="139"><strong><em>include header row</em></strong> (<code>&quot;outputHeaderRow&quot;: true</code> <a href="#hrecipe">in the recipe</a>): include a header row comprising the field names given below</li>
</ul>
</li>
<li class="has-line-data" data-line-start="139" data-line-end="141">
<p class="has-line-data" data-line-start="139" data-line-end="140"><strong>html</strong>: A HTML table with suitable surrounding html syntax so it forms a complete html page</p>
<ul>
<li class="has-line-data" data-line-start="140" data-line-end="141"><strong><em>include header row</em></strong> (<code>&quot;outputHeaderRow&quot;: true</code> <a href="#hrecipe">in the recipe</a>): include a header row (in a HTML <em>thead</em> element) comprising the field names given below</li>
</ul>
</li>
<li class="has-line-data" data-line-start="141" data-line-end="150">
<p class="has-line-data" data-line-start="141" data-line-end="142"><strong>xml</strong>: An XML file, in one of two alternative layouts.</p>
<ul>
<li class="has-line-data" data-line-start="142" data-line-end="143">
<p class="has-line-data" data-line-start="142" data-line-end="143"><strong><em>values as elements rather than attributes</em></strong> (<code>&quot;outputXMLElements&quot;: true</code> <a href="#hrecipe">in the recipe</a>): When checked, each field generated is output as the content of an element named according to the field name given, those elements within a container element for each record. When not checked, each field is output as an attribute of the container record, the attribute name derived from the field name.</p>
</li>
<li class="has-line-data" data-line-start="143" data-line-end="150">
<p class="has-line-data" data-line-start="143" data-line-end="144"><strong><em>element name</em></strong> (<code>&quot;outputName&quot;: &quot;name&quot;</code> <a href="#hrecipe">in the recipe</a>): the name of the record elements. All these elements are wrapped in a containing element named by appending an ‘s’ to this name. So if the name entered is “person”, we’d get an XML file like this:</p>
<pre><code>  &lt;persons&gt;
      &lt;person a=&quot;...&quot; b=&quot;...&quot; ... /&gt;
      &lt;person a=&quot;...&quot; b=&quot;...&quot; ... /&gt;
  &lt;/persons&gt;
</code></pre>
</li>
</ul>
</li>
<li class="has-line-data" data-line-start="150" data-line-end="153">
<p class="has-line-data" data-line-start="150" data-line-end="151"><strong>qif</strong>: Quicken Interchange Format. Arbitrary field names are not allowed in a QIF file, so this also changes the field name box below to a menu of those permitted in QIF files.</p>
<ul>
<li class="has-line-data" data-line-start="151" data-line-end="153"><strong><em>Transaction types</em></strong> (<code>&quot;outputQIFType&quot;: &quot;whatever&quot;</code> <a href="#hrecipe">in the recipe</a>): A QIF file has a header which identifies the kind of content, such as ‘Bank’ for bank statement lines</li>
</ul>
</li>
</ul>
<h2 class="code-line" data-line-start=153 data-line-end=154><a id="Input_settings_153"></a>Input settings</h2>
<p class="has-line-data" data-line-start="155" data-line-end="156">(#hcsv)</p>
<h3 class="code-line" data-line-start=156 data-line-end=157><a id="CSV_file_156"></a>CSV file</h3>
<p class="has-line-data" data-line-start="158" data-line-end="159">Select the CSV file to process. In Chrome you can just drag and drop the file onto the Choose File button. Everything that follows then describes how that CSV file should be interpreted to convert it to output records (which are then formatted according to the chosen file format and options).</p>
<p class="has-line-data" data-line-start="160" data-line-end="161">(#hcsvpaste)</p>
<h3 class="code-line" data-line-start=161 data-line-end=162><a id="Paste_CSV_161"></a>Paste CSV</h3>
<p class="has-line-data" data-line-start="163" data-line-end="164">Instead of choosing a CSV file to be processed, you can paste the data into the box provided. This is most useful when the data source is a table in a web page, which you can then copy and paste directly. In this case, the copy puts a TAB character between each cell, not a comma, so you will need also to set the <a href="#hdelimiter">delimiter character</a> to Tab.</p>
<p class="has-line-data" data-line-start="165" data-line-end="166">(#hencoding)</p>
<h3 class="code-line" data-line-start=166 data-line-end=167><a id="Input_CSV_encoding_166"></a>Input CSV encoding</h3>
<p class="has-line-data" data-line-start="168" data-line-end="169">CSV files are completely ambiguous when it comes to characters that aren’t represented in the basic ASCII character set, such as accented characters, currency symbols and exotic punctuation, not to mention whole languages like Japanese and Hebrew. While Excel does have an option to choose the character set when it is saved, most people do not know about it and are completely unaware of the consequences, namely that a consumer of the CSV may not see currency symbols or non-English names correctly. Typically Excel exports CSVs using a special Windows character set, while Google Sheets does so using the standard international character set called UTF-8.</p>
<p class="has-line-data" data-line-start="170" data-line-end="171">This option (<code>&quot;encoding&quot;: &quot;whatever&quot;</code> <a href="#hrecipe">in the recipe</a>) lets you explicitly state which character set to expect in the CSV (we will try to detect this when set to auto, but it is not always possible to be correct).</p>
<p class="has-line-data" data-line-start="172" data-line-end="173">(#hheaderrows)</p>
<h3 class="code-line" data-line-start=173 data-line-end=174><a id="Header_rows_173"></a>Header rows</h3>
<p class="has-line-data" data-line-start="175" data-line-end="176">Many CSV files have a header row labelling the columns. Some CSV files have additional header rows where people put arbitrary data (for example, a bank statement CSV might use one line for the account number, and another for the sort code).</p>
<p class="has-line-data" data-line-start="177" data-line-end="178">Specify the number of header rows in the CSV here (<code>&quot;headerRows&quot;: 1</code> for example <a href="#hrecipe">in the recipe</a>). Zero means there is no header row at all, while 1 is common.</p>
<p class="has-line-data" data-line-start="179" data-line-end="180">If header rows is 1 or more, the last of them is assumed to contain column headings, and these can be used to identify columns instead or as well as column letters. This can make the settings easier to follow. Column headings and letters are not treated as case-sensitive. Also note that conventionally the 27th and subsequent columns are “AA”, “AB”, “AC” etc, and the 53rd “BA”, “BB”, “BC”, and so on, as in Excel.</p>
<p class="has-line-data" data-line-start="181" data-line-end="182">(#hrowcount)</p>
<h3 class="code-line" data-line-start=182 data-line-end=183><a id="Each_record_formed_from__rows_182"></a>Each record formed from … rows</h3>
<p class="has-line-data" data-line-start="184" data-line-end="185">When the CSV file is processed, typically each row is used to create one (or sometimes more) output records. However, sometimes a record might be formed from a group of rows if the data has been spread over more than one row.</p>
<p class="has-line-data" data-line-start="186" data-line-end="187">This number (<code>&quot;rowCount&quot;: 1</code> for example <a href="#hrecipe">in the recipe</a>) says how many rows to consume (after any rows that are ignored below have been discarded) to construct each record (or group of records). 1 is typical.</p>
<p class="has-line-data" data-line-start="188" data-line-end="189">(#hdelimiter)</p>
<h3 class="code-line" data-line-start=189 data-line-end=190><a id="Delimiter_189"></a>Delimiter</h3>
<p class="has-line-data" data-line-start="191" data-line-end="192">Columns in the CSV are expected to be separated by this character (<code>&quot;delimiterChar&quot;: &quot;,&quot;</code> for example <a href="#hrecipe">in the recipe</a>), usually a comma. If you have tab-separated columns (aka a TSV file), check the “tab” box (as you can’t easily type a tab character).</p>
<p class="has-line-data" data-line-start="193" data-line-end="194">HTML tables copied and pasted as plain text are usually tab-separated, so if you copy a table off a web page and paste it into the <a href="#csvpaste">paste csv box</a>, setting the delimiter to TAB, it should be possible to process data without saving it to a spreadsheet first.</p>
<p class="has-line-data" data-line-start="195" data-line-end="196">(#henclosure)</p>
<h3 class="code-line" data-line-start=196 data-line-end=197><a id="Enclosing_character_196"></a>Enclosing character</h3>
<p class="has-line-data" data-line-start="198" data-line-end="199">Mostly, column data in a CSV file is just listed verbatim, but columns which need to include the delimiter character (e.g. a comma) need to be enclosed by a pair of these characters (<code>&quot;enclosureChar&quot;: &quot;\&quot;&quot;</code> for example <a href="#hrecipe">in the recipe</a>), usually a double quote. This setting allows you to change that character - if the file uses a single quote for example.</p>
<p class="has-line-data" data-line-start="200" data-line-end="201">Where an enclosed field also contains the enclosure character, it needs to be doubled. For example, with a conventional double quote we might have</p>
<pre><code>   ...,&quot;This field has a &quot;&quot; symbol&quot;,...
</code></pre>
<p class="has-line-data" data-line-start="204" data-line-end="205">Or if the delimiter is a slash character and needs to include a single slash:</p>
<pre><code>   ...,/This field has a // symbol/,...
</code></pre>
<p class="has-line-data" data-line-start="208" data-line-end="209">(#hignorerows)</p>
<h3 class="code-line" data-line-start=209 data-line-end=210><a id="Ignore_rows_209"></a>Ignore rows…</h3>
<p class="has-line-data" data-line-start="211" data-line-end="212">People will often put random rows in the middle of CSVs which makes them particularly hard to process in an orderly manner. For example, banks often repeat their a header row every “page”, whatever that might mean.</p>
<p class="has-line-data" data-line-start="213" data-line-end="214">This setting (<code>&quot;ignoreRows&quot;: [ ... ]</code> <a href="#hrecipe">in the recipe</a>) lets you ignore such rows based on one or more criteria. Add a new criterion by pressing the + button, remove an existing one with X, and drag ↕ to change the order. The row is ignored if any one of the criteria is satisfied.</p>
<p class="has-line-data" data-line-start="215" data-line-end="216">You can ignore rows based on the value of a cell in a specified column in the incoming CSV (provide its name, either the column letter or column heading), or based on the value of one of the fields computed from the incoming CSV (provide its name to match one you specify below).</p>
<p class="has-line-data" data-line-start="217" data-line-end="218">See <a href="#hconditions">conditions</a> for details about the conditions (the same set of conditions is used in several different places).</p>
<p class="has-line-data" data-line-start="219" data-line-end="220">Note that rows are not ignored in this way when extracting any header row(s) (where exactly the number given are consumed from the CSV).</p>
<p class="has-line-data" data-line-start="221" data-line-end="222">(#hconcatrows)</p>
<h3 class="code-line" data-line-start=222 data-line-end=223><a id="Combine_rows_222"></a>Combine rows…</h3>
<p class="has-line-data" data-line-start="224" data-line-end="225">While you can read more than one row for all the content, sometimes the CSV will pop in ano extra unexpected row. You can combine rows selectively based on some condition (e.g. first column is empty).</p>
<p class="has-line-data" data-line-start="226" data-line-end="227">This setting (<code>&quot;combineRows&quot;: [ ... ]</code> <a href="#hrecipe">in the recipe</a>) lets you include such rows together based on one or more criteria. Add a new criterion by pressing the + button, remove an existing one with X, and drag ↕ to change the order. The row is combined with the previous if any one of the criteria is satisfied.</p>
<p class="has-line-data" data-line-start="228" data-line-end="229">See <a href="#hconditions">conditions</a> for details about the conditions (the same set of conditions is used in several different places).</p>
<p class="has-line-data" data-line-start="230" data-line-end="231">Note that rows are not combined in this way when extracting any header row(s) (where exactly the number given are consumed from the CSV).</p>
<p class="has-line-data" data-line-start="232" data-line-end="233">Note also that rows will continue to be combined until some row does not meet the condition, and that if each record is normally formed from more than one row, that will continue to apply to the following uncombined rows following.</p>
<p class="has-line-data" data-line-start="234" data-line-end="235">(#hrecords)</p>
<h2 class="code-line" data-line-start=235 data-line-end=236><a id="Output_records_235"></a>Output records</h2>
<p class="has-line-data" data-line-start="237" data-line-end="238">Typically you’ll produce one output record for each input row (that isn’t ignored according to <a href="#hignorerows">ignore rows</a>) or group of however many rows given by <a href="#hrowcount">‘Each record formed from…’</a>. However, occasionally it may be helpful to make more than one record for each row. Each such record would appear consecutively in the output, e.g. as an object in a JSON array or an extra row in an output CSV.</p>
<p class="has-line-data" data-line-start="239" data-line-end="240">For example, you might produce two records from a PayPal transaction where you want to represent a payment as one record (a credit), and the PayPal fee (which PayPal puts in the same row in its exports) as another (a debit: a bank charge).</p>
<p class="has-line-data" data-line-start="241" data-line-end="242">Therefore, the + here lets you add one or more recipes of records to be produced, though you’ll often only need one. (<code>&quot;records&quot;: [ ... ]</code> <a href="#hrecipe">in the recipe</a>). Click X to remove one, and drag ↕ to change the order</p>
<p class="has-line-data" data-line-start="243" data-line-end="244">Each record then comprises a set of fields, and a set of conditions based on those fields when the record will be discarded.</p>
<p class="has-line-data" data-line-start="245" data-line-end="246">(#hfields)</p>
<h2 class="code-line" data-line-start=246 data-line-end=247><a id="Fields_of_output_record_246"></a>Fields of output record</h2>
<p class="has-line-data" data-line-start="248" data-line-end="249">Each field (<code>&quot;fields&quot;: [ ... ]</code> <a href="#hrecipe">in the recipe</a>) of a record comprises a name, one or more columns and bits of verbatim text from which its value is initially composed, and a list of options applied in turn which can transform, omit or reject the value.</p>
<p class="has-line-data" data-line-start="250" data-line-end="251">Add a new field with +, delete an existing one with X, and drag ↕ to change the order</p>
<p class="has-line-data" data-line-start="252" data-line-end="253">Fields are delivered in the order they are specified in the output records.</p>
<p class="has-line-data" data-line-start="254" data-line-end="255">(#hname)</p>
<h3 class="code-line" data-line-start=255 data-line-end=256><a id="Field_name_255"></a>Field name</h3>
<p class="has-line-data" data-line-start="257" data-line-end="258">Field names (<code>&quot;name&quot;: &quot;whatever&quot;</code> <a href="#hrecipe">in the recipe</a>) is used in the output, for example as object member names in JSON, as element names in XML or column headings in CSV, HTML and XLSX.</p>
<p class="has-line-data" data-line-start="259" data-line-end="260">If names contain periods and/or integers in square brackets, then subordinate objects and arrays are constructed for those formats which can support hierarchical output. For example, we might have output fields called “salutation”, “address.city” and “address.postcode”. In JSON output these would appear as:</p>
<pre><code>[
    {
        &quot;salutation&quot;: &quot;Miss Doe&quot;,
        &quot;address&quot;: {
            &quot;city&quot;: &quot;Lerwick&quot;,
            &quot;postcode&quot;: &quot;ZE1 1AA&quot;
        }
    },
    ...
]
</code></pre>
<p class="has-line-data" data-line-start="272" data-line-end="273">and in XML (with elements named “person”) as, for example:</p>
<pre><code>&lt;persons&gt;
    &lt;person&gt;
        &lt;salutation&gt;Miss Doe&lt;/salutation&gt;
        &lt;address&gt;
            &lt;city&gt;Lerwick&lt;/city&gt;
            &lt;postcode&gt;ZE1 1AA&lt;/postcode&gt;
        &lt;/address&gt;
    &lt;/person&gt;
&lt;/persons&gt;
</code></pre>
<p class="has-line-data" data-line-start="284" data-line-end="285">Similarly a field name “people[0].name” might produce</p>
<pre><code>[
    {
        &quot;people&quot;: [
            {
                &quot;name&quot;: &quot;Jane Doe&quot;
            }
        ]
    },
    ...
]
</code></pre>
<p class="has-line-data" data-line-start="297" data-line-end="298">In this way multiple columns of a spreadsheet can be distributed as array elements in the output. It isn’t currently possible to include arbitrary numbers of array elements.</p>
<p class="has-line-data" data-line-start="299" data-line-end="300">In table formats (HTML, CSV, XLSX), the values just appear as consecutive columns headed (when requested) by the dotted/indexed name. Column headings are worked out from the field names of the first record.</p>
<p class="has-line-data" data-line-start="301" data-line-end="302">You can usefully have more than one field with the same name (usually consecutive), providing you set options to omit each in opposite circumstances. For example, say you have debit and credit columns in the original CSV but require a single simple number, positive for credit and negative for debit. So you could make one field from credit and the same field from debit, each of which has the option to omit if zero, and convert to a number, while the debit version of the field also includes the option to negate when converting to a number. (However, if the opposite column is actually always blank rather than zero - the more common case - it would be easier to create a single field comprising both columns and setting the option to prefix the debit column with a minus sign in the concatenation).</p>
<h3 class="code-line" data-line-start=303 data-line-end=304><a id="dont_include_in_output_303"></a>don’t include in output</h3>
<p class="has-line-data" data-line-start="305" data-line-end="306">(<code>&quot;exclude&quot;: true</code> <a href="#hrecipe">in the recipe</a>) excludes the field from the output altogether. This differs from the “omit” conditions in that the field remains in the output record until it is output and is therefore available to be referenced from other fields. In this way, it behaves a bit like a variable.</p>
<p class="has-line-data" data-line-start="307" data-line-end="308">(#hcomprising)</p>
<h3 class="code-line" data-line-start=308 data-line-end=309><a id="Field_concatenated_from_308"></a>Field concatenated from</h3>
<p class="has-line-data" data-line-start="310" data-line-end="311">Concatenate several columns, interleaved with verbatim separators, to make one output field, before applying any options. For example, some banks provide several fields which one might usefully put into a single Description field. You would almost always need at least one column. (<code>&quot;comprising&quot;: [{&quot;item&quot;: &quot;column&quot;, &quot;column&quot;: &quot;A&quot;, ...}, ...]</code> <a href="#hrecipe">in the recipe</a></p>
<p class="has-line-data" data-line-start="312" data-line-end="313">Where there is more than one input row (<a href="#hrowcount">rowCount</a> is greater than 1), you’ll need to say from which of those rows the CSV cell is obtained (this also allows you to concatenate several values vertically from the same column), by giving the row offset (0 for the first row, 1 for the second in each group of rows, and so on).</p>
<p class="has-line-data" data-line-start="314" data-line-end="315">You can also include:</p>
<ul>
<li class="has-line-data" data-line-start="316" data-line-end="318">
<p class="has-line-data" data-line-start="316" data-line-end="317">verbatim text, for example to parenthesis a second column. (<code>&quot;comprising&quot;: [{&quot;item&quot;: &quot;text&quot;, &quot;text&quot;: &quot;whatever text&quot;}, ...]</code> <a href="#hrecipe">in the recipe</a>).</p>
</li>
<li class="has-line-data" data-line-start="318" data-line-end="320">
<p class="has-line-data" data-line-start="318" data-line-end="319">another field as a source for this field. However, it must be a field defined earlier in the record: fields are computed in order, so later fields are not available at this point. (<code>&quot;comprising&quot;: [{&quot;item&quot;: &quot;field&quot;, &quot;field&quot;: &quot;name&quot;, ...}, ...]</code> <a href="#hrecipe">in the recipe</a>).</p>
</li>
<li class="has-line-data" data-line-start="320" data-line-end="322">
<p class="has-line-data" data-line-start="320" data-line-end="321">the value of a column from the previous row rather than the current row being processed.</p>
</li>
<li class="has-line-data" data-line-start="322" data-line-end="324">
<p class="has-line-data" data-line-start="322" data-line-end="323">the value of a field from the previous record output.</p>
</li>
</ul>
<p class="has-line-data" data-line-start="324" data-line-end="325">For fields and columns, check boxes are available to:</p>
<ul>
<li class="has-line-data" data-line-start="326" data-line-end="327">trim any leading or trailing white space (spaces, newlines, tabs) from the column before including it (<code>&quot;trimSpaces&quot;: true</code> <a href="#hrecipe">in the recipe</a>),</li>
<li class="has-line-data" data-line-start="327" data-line-end="328">prefix a minus sign, when input not empty (after any trimming) (<code>&quot;prefixMinus&quot;: true</code> <a href="#hrecipe">in the recipe</a>). Prefixing a minus sign to one of a pair of concatenated columns provides one way to convert separate credit and debit columns, when one or the other is always blank, to a single positive/negative column (currency symbols can be removed later using output options if necessary).</li>
<li class="has-line-data" data-line-start="328" data-line-end="329">append a comma, when input not empty (after any trimming) (<code>&quot;appendComma&quot;: true</code> <a href="#hrecipe">in the recipe</a>), thereby forming a comma separated list from the input columns, and</li>
<li class="has-line-data" data-line-start="329" data-line-end="331">append a space, when input not empty (after any trimming) (<code>&quot;appendSpace&quot;: true</code> <a href="#hrecipe">in the recipe</a>)</li>
</ul>
<p class="has-line-data" data-line-start="331" data-line-end="332">in any combination. This is just a shortcut for including these as verbatim text.</p>
<p class="has-line-data" data-line-start="333" data-line-end="334">Click + to include a new column, field or text, X to remove one, and drag ↕ to change the order</p>
<p class="has-line-data" data-line-start="335" data-line-end="336">(#hoptions)</p>
<h3 class="code-line" data-line-start=336 data-line-end=337><a id="Field_options_336"></a>Field options</h3>
<p class="has-line-data" data-line-start="338" data-line-end="339">After a field value is derived by concatenation from one or more cells in the CSV, that value can be transformed in a variety of ways using field options. More than one option can be applied, in the order they are given. Click + to add a new option, X to delete an existing one, and drag ↕ to change the order.</p>
<p class="has-line-data" data-line-start="340" data-line-end="341">Available options are as follows:</p>
<ul>
<li class="has-line-data" data-line-start="342" data-line-end="344">
<p class="has-line-data" data-line-start="342" data-line-end="343"><strong><em>ignore currency symbols…</em></strong> (<code>&quot;item&quot;: &quot;ignoreCurrency&quot;, &quot;currencies&quot;: &quot;...&quot;</code> <a href="#hrecipe">in the recipe</a>): Any currency symbols (or indeed any other single character) that appears in the list provided are removed from the field value, wherever they appear in the string. Examples: if the currency list was just “£”, and the value so far is “£123.45”, the result would be “123.45”. However, if the list were “°” (the degree symbol) and the value was “90°” this option can also be used to remove that, yielding “90”.</p>
</li>
<li class="has-line-data" data-line-start="344" data-line-end="346">
<p class="has-line-data" data-line-start="344" data-line-end="345"><strong><em>treat ‘(1.23)’ or ‘1.23-’ as negative…</em></strong> (<code>&quot;item&quot;: &quot;bookkeepersNegative&quot;</code> <a href="#hrecipe">in the recipe</a>): accounts sometimes represent negative numbers by enclosing them in parentheses (which makes them more obvious, but hard to process), or even sometimes negatives and positives with a trailing instead of leading minus or plus sign. Convert these into proper negatives with this option. Note that you are still left with a string at the end of this and should probably also convert it to a number (below). Examples: “(123.45)” → “-123.45”; “123.45-” → “-123.45”.</p>
</li>
<li class="has-line-data" data-line-start="346" data-line-end="348">
<p class="has-line-data" data-line-start="346" data-line-end="347"><strong><em>trim surrounding white space</em></strong> (<code>&quot;item&quot;: &quot;trim&quot;</code> <a href="#hrecipe">in the recipe</a>): remove all preceding and trailing spaces, newlines, line-feeds and tabs from the value, any number in any mixture. Example: &quot;  123.45  &quot; → “123.45”</p>
</li>
<li class="has-line-data" data-line-start="348" data-line-end="350">
<p class="has-line-data" data-line-start="348" data-line-end="349"><strong><em>replace all occurences of string</em></strong> (<code>&quot;item&quot;: &quot;replaceString&quot;, &quot;matches&quot;: &quot;string&quot;, &quot;output&quot;: &quot;replacement&quot;</code> <a href="#hrecipe">in the recipe</a>): Replaces all occurences in value of the given string with its replacement. For example, if value is “the cats scattered” match is “cat” and replacement is “dog”, the result is “the dogs sdogtered”!</p>
</li>
<li class="has-line-data" data-line-start="350" data-line-end="352">
<p class="has-line-data" data-line-start="350" data-line-end="351"><strong><em>replace using regular expression</em></strong> (<code>&quot;item&quot;: &quot;transform&quot;, &quot;matches&quot;: &quot;regexp&quot;, &quot;output&quot;: &quot;replacement&quot;</code> <a href="#hrecipe">in the recipe</a>): If the field matches the provided <a href="#hregularexpression">regular expression</a> then it is replaced by the provided replacement. Fragments matched can be substituted using $1, $2 etc for parenthesised elements in the regular expression. Example: if the value is “the cat sat on the mat”, the regular expression “/ c?t /” and the replacement &quot; dog &quot;, we end up with “the dog sat on the mat”.</p>
</li>
<li class="has-line-data" data-line-start="352" data-line-end="354">
<p class="has-line-data" data-line-start="352" data-line-end="353"><strong><em>output as number</em></strong> (<code>&quot;item&quot;: &quot;convertToNumber&quot;, &quot;errorOnType&quot;: true, &quot;negate&quot;: true</code> <a href="#hrecipe">in the recipe</a>): Converts the value to a number in the output, so that you can do artihmetic on it in the output for example (it is also then amenable to the greater and less options in subsequent tests here). If the string value cannot be converted (“12a” for example), then the whole CSV conversion is stopped with an appropriate error message if the <strong><em>stop on conversion</em></strong> box is checked, or output as 0 (zero) otherwise. If the <strong><em>negate after conversion</em></strong> box is checked, the result is the negative of the converted number. For example the debit column of a bank statement may need to produce the negative of the cell contents if being combined with a credit column. Note that if the field is comprised from some column concatenated with the corresponding field in the previous record, you can sum columns from multiple rows.</p>
</li>
<li class="has-line-data" data-line-start="354" data-line-end="356">
<p class="has-line-data" data-line-start="354" data-line-end="355"><strong><em>output as sum of numbers</em></strong> (<code>&quot;item&quot;: &quot;convertToNumberSum&quot;, &quot;errorOnType&quot;: true, &quot;negate&quot;: true</code> <a href="#hrecipe">in the recipe</a>): Converts the value to a number in the output, formed from the sum of multiple numbers in the field. For example, the field might be the space-separated concatenation of two number columns of the input which you wish to add. The numbers forming the sum are separated with any combination of spaces and commas. You can then do artihmetic on it in the output for example (it is also then amenable to the greater and less options in subsequent tests here). If the string value cannot be converted (“123 12a” for example), then the whole CSV conversion is stopped with an appropriate error message if the <strong><em>stop on conversion</em></strong> box is checked, or not included in the sum otherwise. If the <strong><em>negate after conversion</em></strong> box is checked, the result is the negative of the resultng number.</p>
</li>
<li class="has-line-data" data-line-start="356" data-line-end="358">
<p class="has-line-data" data-line-start="356" data-line-end="357"><strong><em>output as ISO date</em></strong> (<code>&quot;item&quot;: &quot;convertToDate&quot;, &quot;errorOnType&quot;: true, &quot;dateFormatUS&quot;: true, &quot;dateFormatTime&quot;: true</code> <a href="#hrecipe">in the recipe</a>): Converts the value to a standardised date whatever its original form. The output format is specified by international standard <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> and looks like “2016-12-02” or “2016-12-02T13:36:45+00:00” if the time is included; many systems recognise this format which is both easily sortable and unambiguous. Conversion uses the Linux <a href="https://php.net/manual/en/function.strtotime.php">strtotime</a> function, so it understands a wide variety of possible values. However, European and US dates written using slashes, such as “3/4/2016” are ambiguous (European is d/m/y hence 3 April, while US is m/d/y, hence March 4), so the <strong><em>US dates</em></strong> check box allows you to indicate which the CSV contains (US if checked). (It does this by replacing slashes with dashes in the European case before presenting to strtotime). If the value is not a comprehensible date, then either the whole CSV conversion is stopped if the <strong><em>stop on conversion</em></strong> box is checked, or output as an empty string otherwise.</p>
</li>
<li class="has-line-data" data-line-start="358" data-line-end="360">
<p class="has-line-data" data-line-start="358" data-line-end="359"><strong><em>output as custom date</em></strong> (<code>&quot;item&quot;: &quot;convertToCustomDate&quot;, &quot;errorOnType&quot;: true, &quot;dateFormatUS&quot;: true, &quot;dateFormatStyle&quot;: &quot;j M Y&quot;</code> <a href="#hrecipe">in the recipe</a>): Similar to ISO date, but you can specify the output style yourself (including time parts). This uses the <a href="https://php.net/manual/en/function.date.php">PHP date function</a> in which letters in the date style are replaced by parts of the date or time. For example “M j, Y” produces dates like “Dec 1, 2016” because M means the abbreviated month name, j means the day without leading zeros and Y means the four digit year. Many other variants are possible - see <a href="https://php.net/manual/en/function.date.php">date</a>.</p>
</li>
<li class="has-line-data" data-line-start="360" data-line-end="362">
<p class="has-line-data" data-line-start="360" data-line-end="361"><strong><em>omit field if…</em></strong> (<code>&quot;item&quot;: &quot;omitIf&quot;, &quot;condition&quot;: &quot;...&quot;, ...</code> <a href="#hrecipe">in the recipe</a>): Having transformed the field by whatever other methods, the field is discarded if the <a href="#hcondition">condition</a> selected here is satisifed. Omiting a field is potentially useful in JSON and XML formats, but in tabular formats (CSV, HTML, XLSX) this would result in columns shifting left by one, so it would be better to transform (above) to an empty string value instead. Note that when a field is omitted, no further options are applied for it and the field is not available to later fields for comparison etc.</p>
</li>
<li class="has-line-data" data-line-start="362" data-line-end="364">
<p class="has-line-data" data-line-start="362" data-line-end="363"><strong><em>carry over from previous record instead if…</em></strong> (<code>&quot;item&quot;: &quot;carryOverIf&quot;, &quot;condition&quot;: &quot;...&quot;, ...</code> <a href="#hrecipe">in the recipe</a>): if the <a href="#hcondition">condition</a> selected here is satisifed, the value already concatenated and transformed by previous options is completely discarded and replaced with the value from the same field in the previous corresponding record (whether or not that record was actually output). In conjunction with conditions on whether to output the record, this can be used to combine values from different rows into a single record.</p>
</li>
<li class="has-line-data" data-line-start="364" data-line-end="366">
<p class="has-line-data" data-line-start="364" data-line-end="365"><strong><em>skip next option if…</em></strong> and <strong><em>skip next option unless…</em></strong> (<code>&quot;item&quot;: &quot;skipIf&quot;, &quot;condition&quot;: &quot;...&quot;, ...</code> or <code>&quot;item&quot;: &quot;Unless&quot;, &quot;condition&quot;: &quot;...&quot;, ...</code> <a href="#hrecipe">in the recipe</a>): The following option can be applied or not depending on the outcome of this <a href="#hcondition">condition</a>.</p>
</li>
<li class="has-line-data" data-line-start="366" data-line-end="368">
<p class="has-line-data" data-line-start="366" data-line-end="367"><strong><em>stop with error if value…</em></strong> (<code>&quot;item&quot;: &quot;errorOnValue&quot;, &quot;condition&quot;: &quot;...&quot;, ...</code> <a href="#hrecipe">in the recipe</a>): Having transformed the field by whatever other methods, the whole conversion process can be terminated if the <a href="#hcondition">condition</a> selected here is satisifed: for example if an unexpected value is encountered.</p>
</li>
</ul>
<p class="has-line-data" data-line-start="368" data-line-end="369">Each of the condition options (skip, omit and stop) can compare the value given with any of:</p>
<ul>
<li class="has-line-data" data-line-start="370" data-line-end="371">the currently computed value for the field from the earlier steps (<code>&quot;test&quot;: &quot;value&quot;</code> <a href="#hrecipe">in the recipe</a>),</li>
<li class="has-line-data" data-line-start="371" data-line-end="372">the value of a column (<code>&quot;test&quot;: &quot;column&quot;, &quot;column&quot;: &quot;header&quot;</code> <a href="#hrecipe">in the recipe</a>)</li>
<li class="has-line-data" data-line-start="372" data-line-end="374">the value of any earlier field (<code>&quot;test&quot;: &quot;field&quot;, &quot;field&quot;: &quot;name&quot;</code> <a href="#hrecipe">in the recipe</a>)</li>
</ul>
<p class="has-line-data" data-line-start="374" data-line-end="375">(#hunless)</p>
<h3 class="code-line" data-line-start=375 data-line-end=376><a id="Dont_output_record_375"></a>Don’t output record…</h3>
<p class="has-line-data" data-line-start="377" data-line-end="378">Having calculated all the fields for a record, the values computed can be used to determine that their record should not be included in the output at all if any of the <a href="#hconditions">conditions</a> given here are satisfied. Press + to add a new condition, X to remove an existing one, and drag ↕ to change the order.</p>
<h2 class="code-line" data-line-start=379 data-line-end=380><a id="Settings_which_are_used_in_several_places_379"></a>Settings which are used in several places</h2>
<p class="has-line-data" data-line-start="381" data-line-end="382">(#hconditions)</p>
<h3 class="code-line" data-line-start=382 data-line-end=383><a id="Conditions_382"></a>Conditions</h3>
<ul>
<li class="has-line-data" data-line-start="384" data-line-end="385"><strong><em>empty (no text at all)</em></strong> (<code>&quot;condition&quot;: &quot;empty&quot;</code> <a href="#hrecipe">in the recipe</a>): there is nothing in the value, not even a space, or for field either the field does not exist or is an empty string.</li>
<li class="has-line-data" data-line-start="385" data-line-end="386"><strong><em>whitespace only or empty</em></strong> (<code>&quot;condition&quot;: &quot;white&quot;</code> <a href="#hrecipe">in the recipe</a>): if the value is empty, as above, or just contains spaces, tabs, newline or line-feed characters, in any combination.</li>
<li class="has-line-data" data-line-start="386" data-line-end="387"><strong><em>matches regular expression</em></strong> (<code>&quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;regexp&quot;</code> <a href="#hrecipe">in the recipe</a>): if the value matches the provided regular expression. See <a href="#hregularexpression">regular expressions</a></li>
<li class="has-line-data" data-line-start="387" data-line-end="388"><strong><em>does not match regular expression</em></strong> (<code>&quot;condition&quot;: &quot;nomatch&quot;, &quot;value&quot;: &quot;regexp&quot;</code> <a href="#hrecipe">in the recipe</a>): if the value does <strong>not</strong> match the provided <a href="#hregularexpression">regular expression</a></li>
<li class="has-line-data" data-line-start="388" data-line-end="389"><strong><em>equal to</em></strong> (<code>&quot;condition&quot;: &quot;eq&quot;, &quot;value&quot;: &quot;whatever&quot;</code> <a href="#hrecipe">in the recipe</a>): if the value is the same as that given. Input cells and output fields which are strings are compared as strings, but fields which are converted to numbers are compared numerically with the given value, so it may be better to use this condition with output fields when numbers are involved.</li>
<li class="has-line-data" data-line-start="389" data-line-end="390"><strong><em>not equal to</em></strong> (<code>&quot;condition&quot;: &quot;ne&quot;, &quot;value&quot;: &quot;whatever&quot;</code> <a href="#hrecipe">in the recipe</a>): if the value is not the same as that given. Comparison as for ‘equal to’.</li>
<li class="has-line-data" data-line-start="390" data-line-end="391"><strong><em>greater or equal to</em></strong> (<code>&quot;condition&quot;: &quot;ge&quot;, &quot;value&quot;: 123</code> <a href="#hrecipe">in the recipe</a>): the value is &gt;= that given this only makes sense for numbers, so both input and output values are first converted to numbers if necessary, and then compared as numbers.</li>
<li class="has-line-data" data-line-start="391" data-line-end="392"><strong><em>less or equal to</em></strong> (<code>&quot;condition&quot;: &quot;le&quot;, &quot;value&quot;: 123</code> <a href="#hrecipe">in the recipe</a>): &lt;= - numerically, as for ‘greater or equal to’.</li>
<li class="has-line-data" data-line-start="392" data-line-end="393"><strong><em>before (date)</em></strong> (<code>&quot;condition&quot;: &quot;before&quot;, &quot;value&quot;: &quot;2016-09-23&quot;</code> <a href="#hrecipe">in the recipe</a>): date comparison - both the date entered and the date being compared must not contain ‘/’, that is must not be ambiguous. In the case of fields, you can always convert to ISO and then convert to another format after comparison, but ignoring rows is only possible for non-ambiguous dates.</li>
<li class="has-line-data" data-line-start="393" data-line-end="394"><strong><em>after (date)</em></strong> (<code>&quot;condition&quot;: &quot;after&quot;, &quot;value&quot;: &quot;2016-09-23&quot;</code> <a href="#hrecipe">in the recipe</a>): date comparison, as “before”.</li>
<li class="has-line-data" data-line-start="394" data-line-end="395"><strong><em>equal to column in previous row</em></strong> (<code>&quot;condition&quot;: &quot;eqprev&quot;, &quot;prevcolumn&quot;: &quot;letter/header&quot;</code>): the condition is met if the value being compared is equal to the column identified by its column letter or heading in the <em>previous</em> row.</li>
<li class="has-line-data" data-line-start="395" data-line-end="397"><strong><em>not equal to column in previous row</em></strong> (<code>&quot;condition&quot;: &quot;neprev&quot;, &quot;prevcolumn&quot;: &quot;letter/header&quot;</code>): the condition is met if the value being compared is different from the column identified by its column letter or heading in the <em>previous</em> row.</li>
</ul>
<p class="has-line-data" data-line-start="397" data-line-end="398">(#hregularexpression)</p>
<h3 class="code-line" data-line-start=398 data-line-end=399><a id="Regular_expressions_398"></a>Regular expressions</h3>
<p class="has-line-data" data-line-start="400" data-line-end="401">Regular expressions are a language for expressing the syntax of a string of text. jcomma uses so-called PCRE-regular expressions, <a href="https://php.net/manual/en/book.pcre.php">as in PHP</a>. The regular expression must include the delimiters (any suitable pair of characters) and any trailing modifiers.</p>
<p class="has-line-data" data-line-start="402" data-line-end="403">See the <a href="https://php.net/manual/en/book.pcre.php">PHP manual</a> for full details of regular expression syntax.</p>
<p class="has-line-data" data-line-start="404" data-line-end="405">For example, the following would match a string comprising only the letters A, B, C or a, b, c (using tilde as the delimiter, the trailing modifier ‘i’ indicating case-independence, ^ and $ requiring start and end of string, and square brackets to indicate a range of characters):</p>
<pre><code>~^[a-c]$~i
</code></pre>
<p class="has-line-data" data-line-start="408" data-line-end="409">Note that when you need to escape a character, in a PHP string you often find you need two backslashes, one for PHP’s literal string syntax, and another for the regular expression itself. Here, these are not PHP literal strings, so only one is required.</p>
<p class="has-line-data" data-line-start="410" data-line-end="411">Where replacement is offered, parenthesised matches can be substituted using $1, $2 etc, just as in PHP.</p>
<p class="has-line-data" data-line-start="412" data-line-end="413">(#hrecipe)</p>
<h2 class="code-line" data-line-start=413 data-line-end=414><a id="JSON_recipe_the_recipe_413"></a>JSON recipe (“the recipe”)</h2>
<p class="has-line-data" data-line-start="415" data-line-end="416">The values entered into the form are turned into a JSON object. This can be <a href="#hsaverecipe">saved to a file</a>.</p>
<p class="has-line-data" data-line-start="417" data-line-end="418">When used from the <a href="#huseapi">API</a>, as a <a href="#huselibrary">library</a>, or in a <a href="#huseshell">shell command</a>, the recipe is supplied in this structured form. (Yes, I know JSON can’t really have comments like this).</p>
<pre><code>{
    &quot;recipeVersion&quot;: 3, # always this for these options
    &quot;outputFormat&quot;: &quot;json&quot;, # csv, html, xlsx, xml
    &quot;outputStyle&quot;: &quot;pretty&quot;, # for json
    &quot;outputBulkElastic&quot;: &quot;true&quot;, # for json, any non empty value
    &quot;outputName&quot;: &quot;whatever&quot;, # filename, also used to name elements where needed by format
    &quot;outputTo&quot;: &quot;inline&quot;, # or &quot;attachment&quot;, or when used as a library, &quot;string&quot;
    &quot;outputEncoding&quot;: &quot;UTF-8&quot;, # or &quot;Windows-1251&quot;. For CSV files only (the others are fixed by the file format)
    &quot;outXMLElements&quot;: &quot;true&quot;, # &lt;x&gt;&lt;k&gt;v&lt;/k&gt;...&lt;/x&gt; rather than &lt;x k=&quot;v&quot; ...&gt;&lt;/x&gt;
    &quot;encoding&quot;: &quot;UTF-8&quot;,
    &quot;headerRows&quot;: 8,
    &quot;delimiterChar&quot;: &quot;,&quot;,
    &quot;enclosureChar&quot;: &quot;\&quot;&quot;,
    &quot;rowCount&quot;: 1, # default 1
    &quot;ignoreRows&quot;: [ # one or more of these (row ignored if any is true):
        {&quot;item&quot;: &quot;column&quot;, &quot;name&quot;: &quot;A&quot;, &quot;condition&quot;: &quot;...&quot;, &quot;value&quot;: &quot;...&quot;}, # conditions as before
        {&quot;item&quot;: &quot;field&quot;, &quot;name&quot;: &quot;name&quot;, &quot;condition&quot;: &quot;...&quot;, &quot;value&quot;: &quot;...&quot;},
        ...
    ],
    &quot;records&quot;: [
        {
            &quot;fields&quot;: [
                {   &quot;name&quot;: &quot;...&quot;,
                    &quot;comprising&quot;: [
                        {&quot;item&quot;: &quot;column&quot;,
                         &quot;column&quot;: &quot;A&quot;,
                         &quot;rowOffset&quot;: 0, # optional, N=0 by default, otherwise from row relative to current from the N specified for the record in rowCount
                         &quot;trimSpaces&quot;: true, # applied first if set
                         &quot;prefixMinus&quot;: true,
                         &quot;appendComma&quot;: true,
                         &quot;appendSpace&quot;: true # comma first if appendComma also set
                        },
                        {&quot;item&quot;: &quot;text&quot;,
                         &quot;text&quot;: &quot;whatever&quot;
                        },
                        {&quot;item&quot;: &quot;field&quot;,
                         &quot;field&quot;: &quot;name&quot;,
                         &quot;trimSpaces&quot;: true, # applied first if set
                         &quot;prefixMinus&quot;: true,
                         &quot;appendComma&quot;: true,
                         &quot;appendSpace&quot;: true # comma first if appendComma also set
                        },
                        ...
                    ],
                    &quot;options&quot;: [ # any of the following, evaluated in turn:
                        {&quot;item&quot;: &quot;ignoreCurrency&quot;, &quot;currencies&quot;: &quot;pound-sign etc&quot;},
                        {&quot;item&quot;: &quot;bookkeepersNegative&quot;}, # (123) or 123- =&gt; -123
                        {&quot;item&quot;: &quot;trim&quot;}, # trim surrounding white space
                        {&quot;item&quot;: &quot;replaceString&quot;, &quot;matches&quot;: &quot;string&quot;, &quot;output&quot;: &quot;substitution&quot;},
                        {&quot;item&quot;: &quot;replaceRegExp&quot;, &quot;matches&quot;: &quot;regexp&quot;, &quot;output&quot;: &quot;stringwithdollarsubstitutions&quot;},
                        {&quot;item&quot;: &quot;convertToNumber&quot;, &quot;errorOnType&quot;: true, &quot;negate&quot;: true}, # any non blank value ok for options
                        {&quot;item&quot;: &quot;convertToDate&quot;, &quot;errorOnType&quot;: true, &quot;dateFormatUS&quot;: true, &quot;dateFormatTime&quot;: true},
                        {&quot;item&quot;: &quot;convertToCustomDate&quot;, &quot;errorOnType&quot;: true, &quot;dateFormatUS&quot;: true, &quot;dateFormatStyle&quot;: &quot;j M Y&quot;}, # per PHP date function
                        {&quot;item&quot;: &quot;omitIf&quot;, &quot;test&quot;: &quot;value&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;},
                        {&quot;item&quot;: &quot;omitIf&quot;, &quot;test&quot;: &quot;field&quot;, &quot;field&quot;: &quot;name&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;},
                        {&quot;item&quot;: &quot;skipIf&quot;, &quot;test&quot;: &quot;value&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;},
                        {&quot;item&quot;: &quot;skipIf&quot;, &quot;test&quot;: &quot;field&quot;, &quot;field&quot;: &quot;name&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;},
                        {&quot;item&quot;: &quot;skipUnless&quot;, &quot;test&quot;: &quot;value&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;},
                        {&quot;item&quot;: &quot;skipUnless&quot;, &quot;test&quot;: &quot;field&quot;, &quot;field&quot;: &quot;name&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;},
                        {&quot;item&quot;: &quot;errorOnValue&quot;, &quot;test&quot;: &quot;value&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;} # match, eq etc, blank, white, nonNumeric
                        {&quot;item&quot;: &quot;errorOnValue&quot;, &quot;test&quot;: &quot;field&quot;, &quot;field&quot;: &quot;name&quot;, &quot;condition&quot;: &quot;match&quot;, &quot;value&quot;: &quot;...&quot;} # match, eq etc, blank, white, nonNumeric
                    ]
                } ,
                ... # more fields
            ],
            &quot;unless&quot;: [ # generate record from row unless any condition is true
                { &quot;field&quot;: &quot;name&quot;, &quot;condition&quot;: &quot;eq&quot;, &quot;value&quot;: &quot;...&quot;},
                ... # more 'unless' conditions, record discarded if any is true
            ]
        },
        ... # more records (occasionally)
    ]
}
</code></pre>
<p class="has-line-data" data-line-start="493" data-line-end="494">(#hinstallation)</p>
<h2 class="code-line" data-line-start=494 data-line-end=495><a id="Installation_494"></a>Installation</h2>
<p class="has-line-data" data-line-start="496" data-line-end="497">Requires PHP &gt;= 5.4. Does not work on older browsers (it’s using a recent version of jQuery). It will probably work on PHP 5.3 except for JSON Pretty Print which would produce a warning in the server error log if used.</p>
<p class="has-line-data" data-line-start="498" data-line-end="499">Put the files in the document root of your web server, ideally a https website, or as a sub-directory of a website.</p>
<p class="has-line-data" data-line-start="500" data-line-end="501">cd to top level and run composer to generate autoload and install dependencies:</p>
<pre><code>composer update
</code></pre>
<p class="has-line-data" data-line-start="504" data-line-end="505">If you can’t use composer, include <code>lib/JComma.php</code> in your project. You will need composer to create the website.</p>
<p class="has-line-data" data-line-start="506" data-line-end="507">You might want to increase the individual file and total file upload limits in your server settings from the PHP default.</p>
<h2 class="code-line" data-line-start=508 data-line-end=509><a id="Acknowledgments_508"></a>Acknowledgments</h2>
<p class="has-line-data" data-line-start="510" data-line-end="511">Apart from PHP and server software, the only dependencies are</p>
<ul>
<li class="has-line-data" data-line-start="511" data-line-end="512"><a href="https://github.com/mk-j/PHP_XLSXWriter">PHP_XLSXWriter</a> for the xlsx file format output, licensed under the MIT license, and</li>
<li class="has-line-data" data-line-start="512" data-line-end="513"><a href="https://jquery.com/">jQuery</a> and <a href="https://jqueryui.com/">jQuery UI</a>, also MIT license.</li>
</ul>
